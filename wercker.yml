# box: alexeiled/go-builder:1.8-onbuild
box: golang:1.7.4
build:
  steps:
    - setup-go-workspace
    
    - script:
        name: install glide
        code: |
          curl https://glide.sh/get | sh
#          glide update novendor
# Gets the dependencies
    - script:
        name: glide install
        code: |
          cd $WERCKER_SOURCE_DIR
          glide install

    # Build the project
    - script:
        name: go build
        code: |
          cd $WERCKER_SOURCE_DIR
          go build $(glide novendor)
    - script:
        name: go install
        code: |      
          go install
          
          find / -name "watchtower*" -print
          ls -lR /go/bin
          
deploy:
  box:
    id: golang:1.7.4

  steps:
    - internal/docker-push:
        username: $DOCKER_HUB_USERNAME
        password: $DOCKER_HUB_PASSWORD
        repository: $DOCKER_HUB_REPO
        tag: $DOCKER_HUB_TAG
        ports: $DOCKER_PORT
        working-dir: /go/bin
        cmd: "/go/bin/watchtower2"
        registry:  https://hub.docker.com

